{% extends "base.html" %}

{% block title %}Notes Manager - TaskMaster Pro{% endblock %}

{% block content %}
<div class="container">
    <div class="header-section">
        <h1 class="page-title">
            <i class="fas fa-sticky-note"></i> Notes Manager
        </h1>
        <p class="subtitle">Capture your ideas and important information</p>
    </div>

    <!-- Statistics Card -->
    <div class="stats-grid" style="grid-template-columns: 1fr;">
        <div class="stat-card stat-notes">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total }}</h3>
                <p>Total Notes</p>
            </div>
        </div>
    </div>

    <!-- Add Note Form -->
    <div class="add-task-section">
        <button class="btn btn-primary" onclick="toggleNoteForm()">
            <i class="fas fa-plus"></i> Add New Note
        </button>
        
        <div id="noteForm" class="task-form" style="display: none;">
            <form method="POST" action="{{ url_for('add_note') }}">
                <div class="form-group">
                    <label for="title">
                        <i class="fas fa-heading"></i> Note Title
                    </label>
                    <input type="text" id="title" name="title" required placeholder="Enter note title...">
                </div>
                
                <div class="form-group">
                    <label for="content">
                        <i class="fas fa-align-left"></i> Note Content
                    </label>
                    <textarea id="content" name="content" rows="6" required placeholder="Write your note here..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="color">
                        <i class="fas fa-palette"></i> Note Color
                    </label>
                    <div class="color-picker">
                        <label class="color-option">
                            <input type="radio" name="color" value="yellow" checked>
                            <span class="color-swatch color-yellow"></span>
                            Yellow
                        </label>
                        <label class="color-option">
                            <input type="radio" name="color" value="blue">
                            <span class="color-swatch color-blue"></span>
                            Blue
                        </label>
                        <label class="color-option">
                            <input type="radio" name="color" value="green">
                            <span class="color-swatch color-green"></span>
                            Green
                        </label>
                        <label class="color-option">
                            <input type="radio" name="color" value="pink">
                            <span class="color-swatch color-pink"></span>
                            Pink
                        </label>
                        <label class="color-option">
                            <input type="radio" name="color" value="purple">
                            <span class="color-swatch color-purple"></span>
                            Purple
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Note
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="toggleNoteForm()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notes Grid -->
    <div class="tasks-section">
        <h2 class="section-title">
            <i class="fas fa-th"></i> My Notes
        </h2>
        
        {% if notes %}
        <div class="notes-grid">
            {% for note in notes|reverse %}
            <div class="note-card note-{{ note.color }}">
                <div class="note-header">
                    <h3 class="note-title">{{ note.title }}</h3>
                    <div class="note-actions">
                        <button class="btn-icon btn-edit" onclick="editNote({{ note.id }}, '{{ note.title }}', `{{ note.content }}`, '{{ note.color }}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <a href="{{ url_for('delete_note', note_id=note.id) }}" 
                           class="btn-icon btn-delete" 
                           onclick="return confirm('Are you sure you want to delete this note?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
                <div class="note-content">
                    {{ note.content }}
                </div>
                <div class="note-footer">
                    <small>
                        <i class="fas fa-clock"></i> 
                        {% if note.updated_at != note.created_at %}
                        Updated: {{ note.updated_at }}
                        {% else %}
                        Created: {{ note.created_at }}
                        {% endif %}
                    </small>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-sticky-note"></i>
            <h3>No notes yet!</h3>
            <p>Start capturing your ideas by creating your first note above.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Edit Note Modal -->
<div id="editModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-edit"></i> Edit Note</h2>
            <button class="close-btn" onclick="closeEditModal()">&times;</button>
        </div>
        <form id="editForm" method="POST">
            <div class="form-group">
                <label for="edit-title">
                    <i class="fas fa-heading"></i> Note Title
                </label>
                <input type="text" id="edit-title" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="edit-content">
                    <i class="fas fa-align-left"></i> Note Content
                </label>
                <textarea id="edit-content" name="content" rows="6" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="edit-color">
                    <i class="fas fa-palette"></i> Note Color
                </label>
                <div class="color-picker">
                    <label class="color-option">
                        <input type="radio" name="color" value="yellow">
                        <span class="color-swatch color-yellow"></span>
                        Yellow
                    </label>
                    <label class="color-option">
                        <input type="radio" name="color" value="blue">
                        <span class="color-swatch color-blue"></span>
                        Blue
                    </label>
                    <label class="color-option">
                        <input type="radio" name="color" value="green">
                        <span class="color-swatch color-green"></span>
                        Green
                    </label>
                    <label class="color-option">
                        <input type="radio" name="color" value="pink">
                        <span class="color-swatch color-pink"></span>
                        Pink
                    </label>
                    <label class="color-option">
                        <input type="radio" name="color" value="purple">
                        <span class="color-swatch color-purple"></span>
                        Purple
                    </label>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save"></i> Update Note
                </button>
                <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function toggleNoteForm() {
    const form = document.getElementById('noteForm');
    if (form.style.display === 'none' || form.style.display === '') {
        form.style.display = 'block';
        document.getElementById('title').focus();
    } else {
        form.style.display = 'none';
    }
}

function editNote(id, title, content, color) {
    document.getElementById('editModal').style.display = 'flex';
    document.getElementById('edit-title').value = title;
    document.getElementById('edit-content').value = content;
    
    // Set the color radio button
    const colorRadios = document.querySelectorAll('#editForm input[name="color"]');
    colorRadios.forEach(radio => {
        radio.checked = (radio.value === color);
    });
    
    // Set form action
    document.getElementById('editForm').action = "{{ url_for('edit_note', note_id=0) }}".replace('0', id);
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target === modal) {
        closeEditModal();
    }
}
</script>
{% endblock %}
